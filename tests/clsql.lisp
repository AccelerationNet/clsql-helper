(defpackage :clsql-helper-test
  (:use :cl :clsql-helper :lisp-unit :iter))

(in-package :clsql-helper-test)
(cl-interpol:enable-interpol-syntax)

(define-test test-clsql-parse-and-print
  (let ((dates
          `(("7/1/2005"
             "07/01/2005 00:00:00" "7/1/2005" "2005-07-01" "2005-07-01 00:00:00")
            ("12/22/2009"
             "12/22/2009 00:00:00" "12/22/2009" "2009-12-22" "2009-12-22 00:00:00")
            ("09/02/2009"
             "09/02/2009 00:00:00" "9/2/2009" "2009-09-02" "2009-09-02 00:00:00")
            ("09/02/09"
             "09/02/2009 00:00:00" "9/2/2009" "2009-09-02" "2009-09-02 00:00:00")
            ("09/02/09 12:15"
             "09/02/2009 12:15:00" "9/2/2009" "2009-09-02" "2009-09-02 12:15:00")
            ("9/2/2009 12:15:02"
             "09/02/2009 12:15:02" "9/2/2009" "2009-09-02" "2009-09-02 12:15:02")
            ("9/2/2009 12:15:02 PM"
             "09/02/2009 12:15:02" "9/2/2009" "2009-09-02" "2009-09-02 12:15:02")
            ("9/2/2009 11:15:02 PM"
             "09/02/2009 23:15:02" "9/2/2009" "2009-09-02" "2009-09-02 23:15:02")
            ("9/2/2009 11:15:02 AM"
             "09/02/2009 11:15:02" "9/2/2009" "2009-09-02" "2009-09-02 11:15:02")
            ("9/2/2009 11:15:02"
             "09/02/2009 11:15:02" "9/2/2009" "2009-09-02" "2009-09-02 11:15:02")
            ("2009-02-20"
             "02/20/2009 00:00:00" "2/20/2009" "2009-02-20" "2009-02-20 00:00:00")
            ("2009-02-20 11:15:02"
             "02/20/2009 11:15:02" "2/20/2009" "2009-02-20" "2009-02-20 11:15:02")
            ("2009-02-20 11:15:02,,0"
             "02/20/2009 11:15:02" "2/20/2009" "2009-02-20" "2009-02-20 11:15:02")
            ("2009-02-20T11:15:02Z"
             "02/20/2009 11:15:02" "2/20/2009" "2009-02-20" "2009-02-20 11:15:02" )
            ("2009-12-20T11:15:02Z"
             "12/20/2009 11:15:02" "12/20/2009" "2009-12-20" "2009-12-20 11:15:02" )
            ("432" nil)
            )))
    (iter (for (d c-time c-date c-iso-date c-iso-time) in dates)
      (for dt = (convert-to-clsql-datetime d))
      (for stime = (print-nullable-datetime dt))
      (for sdate = (print-nullable-date dt))
      (for iso-date = (iso8601-datestamp dt))
      (for iso-time = (iso8601-timestamp dt))
      (assert-equal c-time stime d)
      (assert-equal c-date sdate d)
      (assert-equal c-iso-time iso-time d)
      (assert-equal c-iso-date iso-date d))))

(run-tests)